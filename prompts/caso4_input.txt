# Pseudocódigo (EC)DHE — BUGs en validación y derivación de clave compartida

function derive_shared_secret(client_priv, server_pub, group):
    # BUG 1: no se verifica que 'group' sea permitido/seguro; se acepta cualquier grupo ofertado.
    # BUG 2: no se valida que server_pub sea un punto válido de la curva/grupo.
    # BUG 3: no se maneja el caso de elementos de orden pequeño o el "neutral point".
    # BUG 4: se reusa nonce/ephemeral en múltiples conexiones.

    shared = scalar_mult(client_priv, server_pub, group)
    secret = KDF(shared || "context")  # no se añade transcript hash ni etiquetas contextuales de TLS 1.3
    return secret
